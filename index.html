<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ATM Management System — Browser Version</title>
<style>
    :root{
        --bg:#0b1220; --card:#0f1720; --muted:#9aa4b2; --accent:#29a06b; --danger:#d14;
        --mono: "Courier New", monospace;
    }
    body{
        margin:0;
        background:linear-gradient(180deg,#051018 0%, #071427 100%);
        color:#e6eef6;
        font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
        padding:20px;
        min-height:100vh;
    }
    .wrap{
        max-width:1100px;
        margin:0 auto;
        display:grid;
        grid-template-columns: 380px 1fr;
        gap:18px;
    }
    .card{
        background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        border:1px solid rgba(255,255,255,0.03);
        padding:18px;
        border-radius:12px;
        box-shadow: 0 6px 30px rgba(2,6,23,0.6);
    }
    h1{margin:0 0 8px 0;font-size:20px}
    p.muted{color:var(--muted);margin-top:4px;font-size:13px}
    label{display:block;margin-top:12px;font-size:13px;color:var(--muted)}
    input[type=text], input[type=number], input[type=password] , select {
        width:100%;
        padding:8px 10px;
        margin-top:6px;
        border-radius:8px;
        border:1px solid rgba(255,255,255,0.04);
        background:transparent;
        color:inherit;
        font-size:14px;
    }
    button{
        margin-top:12px;
        padding:10px 12px;
        border-radius:9px;
        border:0;
        background:var(--accent);
        color:#052018;
        font-weight:700;
        cursor:pointer;
    }
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}
    .small{font-size:13px;padding:7px 10px;border-radius:8px}
    .output{
        background:linear-gradient(180deg,#03111b,#041623);
        padding:14px;
        border-radius:10px;
        min-height:420px;
        font-family:var(--mono);
        color:#cfeef0;
        font-size:14px;
        white-space:pre-wrap;
        overflow:auto;
        border:1px solid rgba(255,255,255,0.03);
    }
    .row{display:flex;gap:8px;align-items:center}
    .hidden{display:none}
    .muted-line{color:var(--muted);font-size:13px;margin-top:6px}
    .txn{font-size:13px;color:#bfe8d4;margin-top:6px}
    footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .danger{background:var(--danger);color:white}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="left">
    <div class="topbar">
      <div>
        <h1>ATM Management — Browser</h1>
        <p class="muted">Local demo — accounts stored in your browser.</p>
      </div>
      <div id="sessionInfo" class="muted-line hidden"></div>
    </div>

    <!-- Login box -->
    <div id="loginBox">
      <label>Account Number</label>
      <input id="loginAcc" type="number" placeholder="e.g. 1001" />
      <label>PIN</label>
      <input id="loginPin" type="password" placeholder="4-digit PIN" />
      <div class="row">
        <button id="btnLogin">Login</button>
        <button id="btnShowCreate" class="ghost small">Create account</button>
      </div>
      <p class="muted-line">Use sample accounts: <strong>1001 / 1234</strong>, <strong>1002 / 1111</strong>, <strong>2001 / 2222</strong></p>
    </div>

    <!-- Create account -->
    <div id="createBox" class="hidden">
      <label>New Account Number</label>
      <input id="newAccNo" type="number" />
      <label>Set PIN (4-digit)</label>
      <input id="newPin" type="password" />
      <label>Initial deposit</label>
      <input id="newDeposit" type="number" step="0.01" />
      <div class="row">
        <button id="btnCreate">Create</button>
        <button id="btnCancelCreate" class="ghost small">Cancel</button>
      </div>
      <p class="muted-line">Account numbers must be unique integers.</p>
    </div>

    <!-- After login menu -->
    <div id="menuBox" class="hidden">
      <label>Welcome — Account <span id="acctNumLabel"></span></label>
      <div class="row" style="margin-top:8px">
        <button id="btnBalance">Check Balance</button>
        <button id="btnDeposit" class="ghost">Deposit</button>
        <button id="btnWithdraw" class="ghost">Withdraw</button>
      </div>
      <div class="row">
        <button id="btnMini" class="small">Mini-statement</button>
        <button id="btnChangePin" class="small ghost">Change PIN</button>
        <button id="btnLogout" class="small danger">Logout</button>
      </div>

      <!-- Deposit form -->
      <div id="depositForm" class="hidden">
        <label>Deposit Amount</label>
        <input id="depositAmt" type="number" step="0.01" />
        <button id="confirmDeposit">Confirm Deposit</button>
        <button id="cancelDeposit" class="ghost small">Cancel</button>
      </div>

      <!-- Withdraw form -->
      <div id="withdrawForm" class="hidden">
        <label>Withdraw Amount</label>
        <input id="withdrawAmt" type="number" step="0.01" />
        <button id="confirmWithdraw">Confirm Withdraw</button>
        <button id="cancelWithdraw" class="ghost small">Cancel</button>
      </div>

      <!-- Change PIN form -->
      <div id="changePinForm" class="hidden">
        <label>Current PIN</label>
        <input id="curPin" type="password" />
        <label>New PIN</label>
        <input id="newPin2" type="password" />
        <label>Confirm New PIN</label>
        <input id="confNewPin" type="password" />
        <div class="row">
          <button id="confirmPinChange">Change PIN</button>
          <button id="cancelPinChange" class="ghost small">Cancel</button>
        </div>
      </div>
    </div>

    <footer>
      Built from your C project. Data saved locally to this browser.
    </footer>
  </div>

  <div class="card">
    <h1>Console</h1>
    <p class="muted">Program output, transactions and messages appear below.</p>
    <div id="output" class="output"></div>
  </div>
</div>

<script>
/*
 Browser ATM converted from the provided C program.
 Storage: localStorage (key 'atm_accounts')
*/

const STORAGE_KEY = 'atm_accounts_v1';
const MAX_ACCOUNTS = 200;
const MAX_TXNS = 10;
const PIN_ATTEMPT_LIMIT = 3;

let accounts = [];
let currentAccountIndex = -1; // index in accounts
let pinAttempts = 0;

function nowStr(){
  return new Date().toLocaleString();
}

function loadAccounts(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){
      accounts = [];
      createSampleAccountsIfEmpty();
      saveAccounts();
      return;
    }
    accounts = JSON.parse(raw) || [];
  } catch(e){
    console.error(e);
    accounts = [];
  }
}

function saveAccounts(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(accounts));
}

function createSampleAccountsIfEmpty(){
  if(accounts.length > 0) return;
  addAccountObj({ accountNumber:1001, pin:1234, balance:5000.0, blocked:false, txnCount:0, transactions:[] });
  addAccountObj({ accountNumber:1002, pin:1111, balance:12000.5, blocked:false, txnCount:0, transactions:[] });
  addAccountObj({ accountNumber:2001, pin:2222, balance:250.0, blocked:false, txnCount:0, transactions:[] });
  saveAccounts();
}

function addAccountObj(acc){
  acc.transactions = acc.transactions || [];
  acc.txnCount = acc.txnCount || acc.transactions.length;
  addTransaction(acc, `Account created. Initial deposit: ${acc.balance.toFixed(2)}`);
  accounts.push(acc);
}

function findAccount(accNo){
  return accounts.findIndex(a => a.accountNumber === Number(accNo));
}

function addTransaction(acc, desc){
  const entry = `${nowStr()} | ${desc}`;
  if(!acc.transactions) acc.transactions = [];
  if(acc.transactions.length >= MAX_TXNS){
    acc.transactions.shift();
  }
  acc.transactions.push(entry);
  acc.txnCount = acc.transactions.length;
}

function appendOut(text){
  const out = document.getElementById('output');
  out.textContent = out.textContent + text + "\n";
  out.scrollTop = out.scrollHeight;
}

/* UI wiring */
const loginBox = document.getElementById('loginBox');
const createBox = document.getElementById('createBox');
const menuBox = document.getElementById('menuBox');
const sessionInfo = document.getElementById('sessionInfo');
const acctNumLabel = document.getElementById('acctNumLabel');

document.getElementById('btnShowCreate').addEventListener('click', ()=>{ loginBox.classList.add('hidden'); createBox.classList.remove('hidden'); });
document.getElementById('btnCancelCreate').addEventListener('click', ()=>{ createBox.classList.add('hidden'); loginBox.classList.remove('hidden'); });

document.getElementById('btnCreate').addEventListener('click', ()=>{
  const accNo = Number(document.getElementById('newAccNo').value);
  const pin = Number(document.getElementById('newPin').value);
  const dep = Number(document.getElementById('newDeposit').value) || 0;
  if(!Number.isInteger(accNo) || accNo <= 0) { alert('Invalid account number'); return; }
  if(!Number.isInteger(pin) || pin < 0) { alert('Invalid PIN'); return; }
  if(findAccount(accNo) !== -1){ alert('Account already exists'); return; }
  if(accounts.length >= MAX_ACCOUNTS){ alert('Max accounts reached'); return; }
  const acc = { accountNumber: accNo, pin: pin, balance: Number(dep), blocked:false, txnCount:0, transactions: [] };
  addAccountObj(acc);
  saveAccounts();
  appendOut(`Account ${accNo} created with balance ${acc.balance.toFixed(2)}`);
  createBox.classList.add('hidden');
  loginBox.classList.remove('hidden');
  document.getElementById('newAccNo').value='';
  document.getElementById('newPin').value='';
  document.getElementById('newDeposit').value='';
});

document.getElementById('btnLogin').addEventListener('click', ()=>{
  const accNo = Number(document.getElementById('loginAcc').value);
  const pin = Number(document.getElementById('loginPin').value);
  if(!Number.isInteger(accNo) || !Number.isInteger(pin)){ alert('Enter valid credentials'); return; }
  const idx = findAccount(accNo);
  if(idx === -1){ appendOut(`Login attempt: Account ${accNo} not found.`); alert('Account not found'); return; }
  const acc = accounts[idx];
  if(acc.blocked){ appendOut(`Login blocked for ${accNo}`); alert('Account is blocked. Contact bank.'); return; }
  if(pin === acc.pin){
    currentAccountIndex = idx;
    pinAttempts = 0;
    appendOut(`Authentication successful for account ${accNo}`);
    showMenuForAccount(idx);
    document.getElementById('loginAcc').value=''; document.getElementById('loginPin').value='';
  } else {
    pinAttempts++;
    appendOut(`Incorrect PIN for ${accNo}. Attempts left: ${PIN_ATTEMPT_LIMIT - pinAttempts}`);
    alert(`Incorrect PIN. Attempts left: ${PIN_ATTEMPT_LIMIT - pinAttempts}`);
    if(pinAttempts >= PIN_ATTEMPT_LIMIT){
      acc.blocked = true;
      addTransaction(acc, 'Account blocked due to failed PIN attempts');
      saveAccounts();
      appendOut(`Account ${accNo} blocked due to failed PIN attempts.`);
      pinAttempts = 0;
    }
  }
});

function showMenuForAccount(idx){
  loginBox.classList.add('hidden');
  createBox.classList.add('hidden');
  menuBox.classList.remove('hidden');
  const acc = accounts[idx];
  acctNumLabel.textContent = acc.accountNumber;
  sessionInfo.textContent = `A/C ${acc.accountNumber}`;
  sessionInfo.classList.remove('hidden');
  document.getElementById('depositForm').classList.add('hidden');
  document.getElementById('withdrawForm').classList.add('hidden');
  document.getElementById('changePinForm').classList.add('hidden');
}

document.getElementById('btnLogout').addEventListener('click', ()=>{
  appendOut(`Logging out account ${accounts[currentAccountIndex].accountNumber}`);
  currentAccountIndex = -1;
  menuBox.classList.add('hidden');
  loginBox.classList.remove('hidden');
  sessionInfo.classList.add('hidden');
});

document.getElementById('btnBalance').addEventListener('click', ()=>{
  if(!validSession()) return;
  const acc = accounts[currentAccountIndex];
  appendOut(`Current balance for A/C ${acc.accountNumber}: Rs ${acc.balance.toFixed(2)}`);
});

document.getElementById('btnDeposit').addEventListener('click', ()=>{
  if(!validSession()) return;
  document.getElementById('depositForm').classList.remove('hidden');
});
document.getElementById('cancelDeposit').addEventListener('click', ()=>{ document.getElementById('depositForm').classList.add('hidden'); });

document.getElementById('confirmDeposit').addEventListener('click', ()=>{
  if(!validSession()) return;
  const amt = Number(document.getElementById('depositAmt').value);
  if(isNaN(amt) || amt <= 0){ alert('Invalid amount'); return; }
  const acc = accounts[currentAccountIndex];
  acc.balance += amt;
  addTransaction(acc, `Deposit +${amt.toFixed(2)} | Bal: ${acc.balance.toFixed(2)}`);
  saveAccounts();
  appendOut(`Deposit successful. New balance: ${acc.balance.toFixed(2)}`);
  document.getElementById('depositAmt').value='';
  document.getElementById('depositForm').classList.add('hidden');
});

document.getElementById('btnWithdraw').addEventListener('click', ()=>{
  if(!validSession()) return;
  document.getElementById('withdrawForm').classList.remove('hidden');
});
document.getElementById('cancelWithdraw').addEventListener('click', ()=>{ document.getElementById('withdrawForm').classList.add('hidden'); });

document.getElementById('confirmWithdraw').addEventListener('click', ()=>{
  if(!validSession()) return;
  const amt = Number(document.getElementById('withdrawAmt').value);
  if(isNaN(amt) || amt <= 0){ alert('Invalid amount'); return; }
  const acc = accounts[currentAccountIndex];
  if(amt > acc.balance){ appendOut(`Insufficient balance. Current: ${acc.balance.toFixed(2)}`); alert('Insufficient balance'); return; }
  acc.balance -= amt;
  addTransaction(acc, `Withdrawal -${amt.toFixed(2)} | Bal: ${acc.balance.toFixed(2)}`);
  saveAccounts();
  appendOut(`Withdrawal successful. New balance: ${acc.balance.toFixed(2)}`);
  document.getElementById('withdrawAmt').value='';
  document.getElementById('withdrawForm').classList.add('hidden');
});

document.getElementById('btnMini').addEventListener('click', ()=>{
  if(!validSession()) return;
  const acc = accounts[currentAccountIndex];
  appendOut(`\n--- Mini Statement for A/C ${acc.accountNumber} ---`);
  if(!acc.transactions || acc.transactions.length === 0){
    appendOut('No transactions yet.');
  } else {
    acc.transactions.forEach(t => appendOut(t));
  }
  appendOut('---------------------------------');
});

document.getElementById('btnChangePin').addEventListener('click', ()=>{
  if(!validSession()) return;
  document.getElementById('changePinForm').classList.remove('hidden');
});
document.getElementById('cancelPinChange').addEventListener('click', ()=>{ document.getElementById('changePinForm').classList.add('hidden'); });

document.getElementById('confirmPinChange').addEventListener('click', ()=>{
  if(!validSession()) return;
  const cur = Number(document.getElementById('curPin').value);
  const n1 = Number(document.getElementById('newPin2').value);
  const n2 = Number(document.getElementById('confNewPin').value);
  const acc = accounts[currentAccountIndex];
  if(cur !== acc.pin){ alert('Incorrect current PIN'); return; }
  if(!Number.isInteger(n1) || n1 < 0){ alert('Invalid new PIN'); return; }
  if(n1 !== n2){ alert('New PINs do not match'); return; }
  acc.pin = n1;
  addTransaction(acc, 'PIN changed');
  saveAccounts();
  appendOut('PIN changed successfully.');
  document.getElementById('curPin').value=''; document.getElementById('newPin2').value=''; document.getElementById('confNewPin').value='';
  document.getElementById('changePinForm').classList.add('hidden');
});

function validSession(){
  if(currentAccountIndex === -1){ alert('Login first'); return false; }
  return true;
}

/* initialization */
loadAccounts();
appendOut('ATM Browser App initialised.');
appendOut('Sample accounts ready. Use Login to test.');
</script>
</body>
</html>

